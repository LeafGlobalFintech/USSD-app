<?phpinclude_once './include/APinterface.php';// Reads the variables sent via POST from our gateway$sessionId = $_POST[ "sessionId" ];$serviceCode = $_POST[ "serviceCode" ];$phoneNumber = $_POST[ "phoneNumber" ];$text = $_POST[ "text" ];$phoneNumber = substr( $phoneNumber, 1 );//$text = backFunction($text);$levels = explode("*", $text );$userDetailsEngine = new User_details();$userDetailsEngine->phone = $phoneNumber;if ( $userDetailsEngine->getUserAccbyPhone() ) {    $userDetailsEngine->getClientDetails();    $name = $userDetailsEngine->first_name;    if ( $levels[0] == "" ) {        // This is the first request. Note how we start the response with CON        $response = "CON Welcome to Leaf Service,$name \n";        $response .= "1. Check Balance \n";        $response .= "2. Transfer\n";        $response .= "3. Edit Profile\n";    } else if ( $levels[0] == "1" && !isset($levels[1]) ) {        // Business logic for first level response        $userDetailsEngine->getClientAccBalance();        $balance = $userDetailsEngine->acc_balance;        $response = "END Dear $name, your account balance is $balance RWF \n";    } else if ( $levels[0] == "2" && !isset($levels[1]) ) {        $response = "CON Select Transfer Type \n";        $response .= "1. Leaf to Leaf \n";        $response .= "2. Mobile Money\n";        $response .= "0. Back";    } else if ( $levels[0] == "3" && !isset($levels[1]) ) {        $response = "END Edit Profile \n";        $response .= "1. Change PIN\n";        $response .= "0. Back";    } else if (  isset($levels[0]) && $levels[0] == 1 && $levels[1]==1 ) {        $userDetailsEngine->getClientAccBalance();        $balance = $userDetailsEngine->acc_balance;        // Business logic for first level response        $response = "END Dear $name, your account balance is $balance RWF \n";        $response .= "Your mobile number is $phoneNumber, thank you";    } else if ( isset($levels[0]) && $levels[0] == 2 && $levels[1] == 1 && !isset($levels[2])  ) {        $response = "CON Enter Leaf Account number \n";    } else if ( isset($levels[0]) && $levels[0] == 1 && $levels[1]==3 ) {        $response = "END Edit Profile \n";        $response .= "1. Change PIN\n";        $response .= "0. Exit";    }    else if ( isset($levels[0]) && $levels[0] == 2 && $levels[1] == 1 && isset($levels[2]) && strlen($levels[2])==6 && !isset($levels[3]) ) {        $response = "CON Enter amount to transfer \n";    }        else if ( isset($levels[0]) && $levels[0] == 2 && $levels[1] == 1 && isset($levels[2]) && strlen($levels[2])==6 && isset($levels[3]) && $levels[3] !="" && !isset($levels[4]) ) {        $response = "CON Enter 1 to confirm \n";    }        else if ( isset($levels[0]) && $levels[0] == 2 && $levels[1] == 1 && isset($levels[2]) && strlen($levels[2])==6 && isset($levels[3]) && $levels[3] !="" && $levels[4] ==1 ) {                $acc_num = $levels[2];        $amount = $levels[3];        $value = $userDetailsEngine->transferBetweenCustomers($acc_num,$amount);                if ($value == 0){            $response = "END Transfer of $amount to $acc_num was Successful! \n";        }        else if ($value == -2){           $response = "END Something went wrong  \n";         }        else if ($value == -3){            $response = "END Sorry, You cannot transfer to yourself!  \n";        }        else{            $response = "END Insufficient Balance \n";        }                            }        // Print the response onto the page so that our gateway can read it    header( 'Content-type: text/plain' );    echo $response;} else {    $response = "END Unregistered Number.\nPlease visit a Leaf agent to get an Account. Thank you \n";    // Print the response onto the page so that our gateway can read it    header( 'Content-type: text/plain' );    echo $response;}// DONE!!!?>